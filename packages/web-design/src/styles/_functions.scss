@use "sass:list";
@use "sass:map";
@use "sass:string";
@use "sass:meta";

// Deep getter for arbitrarily nested token maps
@function map-deep-get($map, $keys...) {
  $value: $map;
  @each $key in $keys {
    @if meta.type-of($value) == "map" and map.has-key($value, $key) {
      $value: map.get($value, $key);
    } @else {
      @return null;
    }
  }
  @return $value;
}

// Join a list of identifiers into a CSS variable name
@function token-name($namespace, $path) {
  $joined: "";
  @for $i from 1 through list.length($path) {
    $sep: if($i == 1, "", "-");
    $joined: $joined + $sep + list.nth($path, $i);
  }
  @return "--" + $namespace + "-" + $joined;
}

// Emit CSS custom properties for the given token map using CTI+S path
@mixin emit-css-variables($token-map, $namespace: "sys", $path: ()) {
  @each $key, $value in $token-map {
    $next-path: list.append($path, $key);
    @if meta.type-of($value) == "map" {
      @include emit-css-variables($value, $namespace, $next-path);
    } @else if meta.type-of($value) == "list" and list.length($value) == 0 {
      // Skip empty lists (which is how SCSS represents empty maps)
    } @else {
      #{token-name($namespace, $next-path)}: #{$value};
    }
  }
}

// Helper to reference system-level CSS custom properties in components
@function sys-var($path...) {
  @return var(#{token-name("sys", $path)});
}

// Helper to reference reference-level values directly
@function ref-var($path...) {
  @return var(#{token-name("ref", $path)});
}

// Convert component token paths into CSS variable references
@function comp-var($path...) {
  @return var(#{token-name("comp", $path)});
}
